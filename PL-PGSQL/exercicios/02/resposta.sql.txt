CREATE TRIGGER INSERE_SOCIO AFTER INSERT
ON PARTICIPA FOR EACH ROW
EXECUTE PROCEDURE VERIFICA();

CREATE OR REPLACE FUNCTION VERIFICA() RETURNS TRIGGER AS $$
DECLARE NUMSOCIOS INT;
DECLARE NUMVAGAS INT;
BEGIN
	SELECT COUNT(*) FROM PARTICIPA INTO NUMSOCIOS WHERE 
	SELECT VAGAS FROM CLUBE INTO NUMVAGAS WHERE CLUBE.CODCLUBE = NEW.CODCLUBE;
	IF NUMSOCIOS > NUMVAGAS
		THEN RAISE EXCEPTION 'NÚMERO MÁXIMO DE SÓCIOS';
	END IF;
RETURN NEW;
END;
$$ LANGUAGE 'plpgsql';

--CRIA ESTADO--
INSERT INTO ESTADO(SIGLAESTADO, NOME_ESTADO) VALUES ('RS', 'RIO GRANDE DO SUL');

--CRIA MUN--
INSERT INTO MUNICIPIO(CODMUN, NOME_MUN, AREA_MUN, SIGLAESTADO, POPULACAO_MUN) VALUES (1, 'SANTA MARIA', 12000, 'RS', 500000);

--INSERE SOCIOS--
INSERT INTO SOCIO(CODSOCIO, NOME_SOCIO, IDADE) VALUES (1, 'William', 19);
INSERT INTO SOCIO(CODSOCIO, NOME_SOCIO, IDADE) VALUES (2, 'Joao', 26);
INSERT INTO SOCIO(CODSOCIO, NOME_SOCIO, IDADE) VALUES (3, 'Pedro', 20);

--CRIA CLUBE--
INSERT INTO CLUBE(CODCLUBE, NOME_CLUBE, CODMUN, VAGAS) VALUES (1, 'POLI', 1, 2);

--ASSOCIA SOCIO AO CLUBE--
INSERT INTO PARTICIPA(CODCLUBE, CODSOCIO) VALUES (1, 1);